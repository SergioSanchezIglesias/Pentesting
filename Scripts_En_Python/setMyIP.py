#!/usr/bin/python3

import sys
import os
import fileinput
import re

from colorama import init, Fore, Back, Style

EXIT_SUCCESS = 0
EXIT_FAILURE = 1

def encontrar_patron(file):
    fileV = open(file, "r")
    patron = 'local_ip = \".*\"'
    previous_line = ""

    for line in fileV:
        ocurrency = re.findall(patron, line)
        if ocurrency:
            previous_line = ocurrency[0]
            fileV.close()
            return previous_line
    
    print(Fore.RED + "IP no encontrada en el archivo." + Fore.RESET)
    fileV.close()
    sys.exit(EXIT_FAILURE)


def set_IP(file, replace_line):
    fileV = open(file, "r")
    previous_line = encontrar_patron(file)
    replacement = ""

    for line in fileV:
        #line = line.strip()
        changes = line.replace(previous_line, replace_line)
        replacement = replacement + changes 
    
    fileV.close()

    fout = open(file, "w")
    fout.write(replacement)
    fout.close()

def main(args):
    if len(args) == 2:
        
        replace_line = "local_ip = \"" + args[1] + "\""
        file = "/home/sergio/.config/qtile/settings/widgets.py"

        set_IP(file, replace_line)
    else:
        print(Fore.RED + "Introduce una direccion IP" + Fore.RESET)
        sys.exit(EXIT_FAILURE)


if __name__ == "__main__":
    sys.exit(main(sys.argv))